<!DOCTYPE html>
<html>
<header>
  <meta charset="utf-8" />
  <title>DoodleChamp lobby</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  {% load static %}
</header>

<body>
  <h2>Join code: {{ game_room_name }}</h2>

  {{ game_room_name|json_script:"room-name" }}

  <div class="container text-center">
    <div class="row">
      <div class="col border">word</div>
    </div>
    <div class="row">
      <div class="col border">
        Player List
        <div id="player-list">

        </div>
      </div>
      <div class="col border">
        <canvas id="draw-area" class="border"></canvas>
      </div>
      <div id="chat" class="col border">
        chat
        <input id="chat-field" type="text">
        <button id="guess-btn">guess</button>
      </div>
    </div>
    <div class="row">
        <div id="draw-tools" class="col border"></div>
        
        <!-- <br>
        
          Draw
          <button id="pencil-btn" class="btn-sm" onclick="pencil">&#9998</button>
          <button id="rectangle-btn" class="btn-sm" onclick="rectangle">&#11036</button>
          <button id="line-btn" class="btn-sm" onclick="line">&#8213</button>
          <button id="circle-btn" class="btn-sm" onclick="circle">&#x25EF</button>
          <button id="undo-btn">undo</button>
          <input type="Color" id="color-val" name="" class="form-control form-control-color" value="#000000"> -->
        
    </div>
  </div>
    <br>

    <!-- Button trigger modal -->
    <button id="see-words" type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">
      See Words
    </button>
    <button id="test-btn">test</button>
    <button id="end-btn">end</button>

    <!-- Modal -->
    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h1 class="modal-title fs-5" id="exampleModalLabel">Words</h1>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div id="words-list" class="modal-body">
            Words
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            <button type="button" class="btn btn-primary">Save changes</button>
          </div>
        </div>
      </div>
    </div>

    <script>
      const username = "{{username}}";
      const chatSocket = new WebSocket(
        'ws://'
        + window.location.host
        + '/ws/DoodleChamp/'
        + '{{game_room_name}}'
        + '/'
      );
      

      chatSocket.onopen = function (e) {
            let playerList = document.getElementById("player-list");
            let pElements = playerList.getElementsByTagName('p');

            // Loop through all p elements and remove them from the div
            while (pElements.length > 0) {
              playerList.removeChild(pElements[0]);
              console.log("removed");
            }
            console.log("connect");
            chatSocket.send(JSON.stringify({
              'type' : "DoodleChamp_app_player_joins",
              'player': "{{username}}"
            }))
          }
      chatSocket.onclose = function (e) {
              console.error('Chat socket closed unexpectedly');
            };
    </script>
    <script type="text/javascript" src="../../static/DoodleChamp_app/js/game.js"></script>
</body>

</html>